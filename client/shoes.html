<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Catalog - Shoe Store</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="container">
  <header class="row">
    <h1>Shoes</h1>
    <nav class="row gap">
      <a href="orders.html">My Orders</a>
      <button id="logout">Logout</button>
    </nav>
  </header>

  <section class="card row gap wrap">
    <input id="q" placeholder="Search (model/category)">
    <input id="brand" placeholder="Brand (e.g., Nike)">
    <select id="sort">
      <option value="new">Newest</option>
      <option value="price_asc">Price ↑</option>
      <option value="price_desc">Price ↓</option>
    </select>
    <button id="search">Search</button>
  </section>

  <div id="list" class="grid"></div>

  <div class="row gap">
    <button id="prev">Prev</button>
    <span id="pageInfo" class="muted"></span>
    <button id="next">Next</button>
  </div>

  <pre id="msg" class="msg"></pre>

  <script type="module">
    import { apiFetch, requireLogin, logout, escapeHtml } from "./app.js";
    requireLogin();

    let page = 1;
    const limit = 8;

    async function load() {
      const q = document.getElementById("q").value.trim();
      const brand = document.getElementById("brand").value.trim();
      const sort = document.getElementById("sort").value;

      const params = new URLSearchParams({ page, limit, sort });
      if (q) params.set("q", q);
      if (brand) params.set("brand", brand);

      try {
        const r = await apiFetch(`/api/shoes?${params.toString()}`);
        document.getElementById("pageInfo").textContent = `Page ${r.page} / ${Math.ceil(r.total / r.limit) || 1}`;
        render(r.items);
        document.getElementById("msg").textContent = "";
      } catch (e) {
        document.getElementById("msg").textContent = e.message;
      }
    }

    function render(items) {
      const el = document.getElementById("list");
      el.innerHTML = "";
      for (const s of items) {
        const card = document.createElement("a");
        card.className = "card";
        card.href = `shoe.html?id=${s._id}`;
        card.innerHTML = `
          <h3>${escapeHtml(s.model)}</h3>
          <p class="muted">${escapeHtml(s.brand?.name || "")} • ${escapeHtml(s.category || "")}</p>
          <p>Price: <b>${s.price}</b></p>
          <p>Stock: ${s.stock_quantity}</p>
        `;
        el.appendChild(card);
      }
    }

    document.getElementById("search").onclick = () => { page = 1; load(); };
    document.getElementById("prev").onclick = () => { page = Math.max(1, page - 1); load(); };
    document.getElementById("next").onclick = () => { page = page + 1; load(); };
    document.getElementById("logout").onclick = logout;

    load();
  </script>
</body>
</html>
